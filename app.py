import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ì§€ì›ì„¼í„°", page_icon="ğŸ¥", layout="wide")

# ë°ì´í„° ë¡œë“œ (ë°ëª¨ ë°ì´í„°)
centers_data = [
    {"ì„¼í„°ëª…": "ë™ëŒ€ë¬¸êµ¬ ì¹˜ë§¤ì•ˆì‹¬ì„¼í„°", "í–‰ì •ë™": "ìš©ì‹ ë™", "ëŒ€ìƒ": "ì–´ë¥´ì‹ ", "ìœ„ë„": 37.574, "ê²½ë„": 127.039, "ì†Œê°œ": "ì¹˜ë§¤ ì˜ˆë°©Â·ìƒë‹´ ë° ê°€ì¡± ì§€ì› ì„œë¹„ìŠ¤ ì œê³µ"},
    {"ì„¼í„°ëª…": "ë™ëŒ€ë¬¸êµ¬ ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„°", "í–‰ì •ë™": "íšŒê¸°ë™", "ëŒ€ìƒ": "ì „ì²´", "ìœ„ë„": 37.592, "ê²½ë„": 127.055, "ì†Œê°œ": "ì •ì‹ ê±´ê°• ìƒë‹´, ì¬í™œ ë° ìì‚´ì˜ˆë°© ì„œë¹„ìŠ¤"},
    {"ì„¼í„°ëª…": "ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ê°€ì •ì§€ì›ì„¼í„°", "í–‰ì •ë™": "ë‹µì‹­ë¦¬ë™", "ëŒ€ìƒ": "ê°€ì¡±", "ìœ„ë„": 37.569, "ê²½ë„": 127.067, "ì†Œê°œ": "ê°€ì¡± êµìœ¡, ëŒë´„ ë‚˜ëˆ” ë° ë‹¤ë¬¸í™”ê°€ì¡± ì§€ì› í”„ë¡œê·¸ë¨ ìš´ì˜"}
]
centers_df = pd.DataFrame(centers_data)

programs_data = [
    {"ì¹´í…Œê³ ë¦¬": "ê±´ê°•ìƒí™œ", "í”„ë¡œê·¸ë¨ëª…": "ìƒí™œì²´ìœ¡ ìš”ê°€ êµì‹¤", "ê¸°ê°„": "2025-05-01 ~ 2025-06-30", "ëŒ€ìƒ": "ì„±ì¸ ì£¼ë¯¼", "ì¥ì†Œ": "êµ¬ë¯¼ì²´ìœ¡ì„¼í„°", "ë¬¸ì˜": "02-000-0000"},
    {"ì¹´í…Œê³ ë¦¬": "ì •ì‹ ê±´ê°•", "í”„ë¡œê·¸ë¨ëª…": "ë§ˆìŒê±´ê°• ìƒë‹´ ì±—ë´‡", "ê¸°ê°„": "ìƒì‹œ ìš´ì˜", "ëŒ€ìƒ": "ì „ì²´", "ì¥ì†Œ": "ì˜¨ë¼ì¸ (ì›¹/ì•±)", "ë¬¸ì˜": "02-111-1111"},
    {"ì¹´í…Œê³ ë¦¬": "ê°€ì¡±ì§€ì›", "í”„ë¡œê·¸ë¨ëª…": "ë¶€ëª¨-ìë…€ ê´€ê³„ ê°œì„  ì›Œí¬ìˆ", "ê¸°ê°„": "2025-07-15 ~ 2025-07-15", "ëŒ€ìƒ": "ë¶€ëª¨ ë° ìë…€", "ì¥ì†Œ": "ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ê°€ì •ì§€ì›ì„¼í„°", "ë¬¸ì˜": "02-222-2222"}
]
programs_df = pd.DataFrame(programs_data)

# ì‚¬ì´ë“œë°” ë©”ë‰´
st.sidebar.title("ğŸ“Œ ë©”ë‰´")
page = st.sidebar.radio("í˜ì´ì§€ ì´ë™", ["ì†Œê°œ", "ì„¼í„° ì§€ë„", "í”„ë¡œê·¸ë¨ ì‹ ì²­"])

# 1ï¸âƒ£ ì†Œê°œ í˜ì´ì§€
if page == "ì†Œê°œ":
    st.header("ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ì§€ì›ì„¼í„° ì†Œê°œ")
    st.markdown("ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ì§€ì›ì„¼í„°ëŠ” ì§€ì—­ì£¼ë¯¼ì˜ ê±´ê°•ì¦ì§„ê³¼ ë³µì§€í–¥ìƒì„ ìœ„í•´ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì¢…í•© ì§€ì› ê¸°ê´€ì…ë‹ˆë‹¤.")
    st.subheader("ìš´ì˜ ë°©ì‹ ë° ëª©í‘œ")
    st.markdown("âœ… **ì°¾ì•„ê°€ëŠ” ì„œë¹„ìŠ¤:** ê±°ë™ì´ ë¶ˆí¸í•œ ì£¼ë¯¼ì„ ì§ì ‘ ì°¾ì•„ëµ™ëŠ” ë°©ë¬¸ ê±´ê°•ê´€ë¦¬ ì œê³µ")
    st.markdown("âœ… **í†µí•© ìƒë‹´:** ì˜ë£Œ, ì‹¬ë¦¬, ë³µì§€ ë“± ë¶„ì•¼ë³„ ì „ë¬¸ê°€ ìƒë‹´ì„ í•œ ê³³ì—ì„œ ì§€ì›")
    st.markdown("ğŸ’¡ **ëª©ì :** ì£¼ë¯¼ ëª¨ë‘ê°€ :blue[ê±´ê°•í•œ ì‚¶]ì„ ëˆ„ë¦¬ë„ë¡ ì˜ˆë°©ë¶€í„° ê´€ë¦¬ê¹Œì§€ ë•ëŠ” ê²ƒ")
    st.markdown("ğŸ’¡ **ë¹„ì „:** í•¨ê»˜ ëŒë³´ê³  í•¨ê»˜ ë‚˜ëˆ„ëŠ” ì§€ì—­ì‚¬íšŒ êµ¬í˜„")
    st.subheader("ì£¼ìš” ì„œë¹„ìŠ¤ ë¶„ì•¼")
    st.markdown("- ğŸ©º **ê±´ê°• ê²€ì§„ ë° ìƒë‹´**: ê¸°ì´ˆ ê±´ê°•ê²€ì§„, ë§Œì„±ì§ˆí™˜ ê´€ë¦¬ ìƒë‹´")
    st.markdown("- ğŸ§  **ì •ì‹ ê±´ê°• ì§€ì›**: ìš°ìš¸ì¦, ì¹˜ë§¤ ë“± ì •ì‹ ê±´ê°• ì˜ˆë°© í”„ë¡œê·¸ë¨")
    st.markdown("- ğŸ¤¸ **ê±´ê°•ìƒí™œ ì‹¤ì²œ**: ìš´ë™ êµì‹¤, ì˜ì–‘ ê´€ë¦¬ êµìœ¡ ë“± ìƒí™œìŠµê´€ ê°œì„ ")
    st.markdown("- ğŸ¤ **ê°€ì¡± ë° ëŒë´„ ì§€ì›**: ìœ¡ì•„ ë‚˜ëˆ”í„° ìš´ì˜, ì¹˜ë§¤ê°€ì¡± ì‰¼í„° ì§€ì›")
    st.info("â€» ê° ë¶„ì•¼ë³„ ìƒì„¸ í”„ë¡œê·¸ë¨ì€ 'í”„ë¡œê·¸ë¨ ì‹ ì²­' íƒ­ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.")

# 2ï¸âƒ£ ì„¼í„° ì§€ë„ í˜ì´ì§€
elif page == "ì„¼í„° ì§€ë„":
    st.header("ğŸ“ ë™ëŒ€ë¬¸êµ¬ ê±´ê°•ì§€ì›ì„¼í„° ì§€ë„")
    
    # í•„í„°
    col1, col2, col3 = st.columns([1, 1, 1])
    with col1:
        dong_options = ["ì „ì²´"] + sorted(centers_df["í–‰ì •ë™"].unique())
        sel_dong = st.selectbox("í–‰ì •ë™", dong_options, index=0)
    with col2:
        keyword = st.text_input("ê²€ìƒ‰", placeholder="ì„¼í„° ì´ë¦„ ê²€ìƒ‰")
    with col3:
        target_options = ["ì „ì²´"] + sorted(centers_df["ëŒ€ìƒ"].unique())
        sel_target = st.selectbox("ëŒ€ìƒêµ°", target_options, index=0)
    
    # í•„í„°ë§ ë¡œì§
    filtered = centers_df.copy()
    if sel_dong != "ì „ì²´":
        filtered = filtered[filtered["í–‰ì •ë™"] == sel_dong]
    if sel_target != "ì „ì²´":
        filtered = filtered[filtered["ëŒ€ìƒ"] == sel_target]
    if keyword:
        filtered = filtered[filtered["ì„¼í„°ëª…"].str.contains(keyword, case=False)]

    # ì§€ë„ ìƒì„±
    center_lat, center_lon = 37.57, 127.04
    m = folium.Map(location=[center_lat, center_lon], zoom_start=13, tiles="cartodbpositron")
    for _, row in filtered.iterrows():
        folium.Marker([row["ìœ„ë„"], row["ê²½ë„"]],
                      popup=f"{row['ì„¼í„°ëª…']}<br>{row['í–‰ì •ë™']}<br>{row['ì†Œê°œ']}",
                      tooltip=row["ì„¼í„°ëª…"]).add_to(m)
    st_folium(m, height=500, width=None)

# 3ï¸âƒ£ í”„ë¡œê·¸ë¨ ì‹ ì²­ í˜ì´ì§€
elif page == "í”„ë¡œê·¸ë¨ ì‹ ì²­":
    st.header("ğŸ“ ê±´ê°•ì§€ì›ì„¼í„° í”„ë¡œê·¸ë¨ ì‹ ì²­")
    categories = programs_df["ì¹´í…Œê³ ë¦¬"].unique()
    for cat in categories:
        cat_programs = programs_df[programs_df["ì¹´í…Œê³ ë¦¬"] == cat]
        st.subheader(f"â–¶ {cat}")
        for _, prog in cat_programs.iterrows():
            with st.container():
                st.markdown(f"**{prog['í”„ë¡œê·¸ë¨ëª…']}**  \nê¸°ê°„: {prog['ê¸°ê°„']} | ëŒ€ìƒ: {prog['ëŒ€ìƒ']} | ì¥ì†Œ: {prog['ì¥ì†Œ']}")
                st.caption(f"ë¬¸ì˜: {prog['ë¬¸ì˜']}")
                with st.expander("í”„ë¡œê·¸ë¨ ì‹ ì²­í•˜ê¸°"):
                    with st.form(key=f"form_{prog['í”„ë¡œê·¸ë¨ëª…']}"):
                        st.text_input("ì´ë¦„", placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")
                        st.text_input("ì—°ë½ì²˜", placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”")
                        st.text_area("í•˜ê³ ì‹¶ì€ ë§", placeholder="ë¬¸ì˜ì‚¬í•­ ë˜ëŠ” ìš”ì²­ì‚¬í•­ (ì„ íƒ)")
                        if st.form_submit_button("ì œì¶œ"):
                            st.success(f"âœ… {prog['í”„ë¡œê·¸ë¨ëª…']} ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
